# 🏗️ Kubernetes Architecture – Complete Notes

---

## 📜 Overview

Kubernetes is an open-source container orchestration platform that manages containerized applications across a **cluster of nodes**. It abstracts away infrastructure complexity and provides automation, scalability, and fault tolerance.

Kubernetes architecture follows a **master-worker (control plane–node)** model and is **declarative** and **event-driven** in nature.

---

## 🧠 High-Level Components

### 🧭 Control Plane (Cluster Management / Master Components)

Responsible for the **global decision-making** in the cluster.

| Component        | Description |
|------------------|-------------|
| **API Server**   | Front-end for Kubernetes, handles all RESTful communication. Central communication hub. Exposes the Kubernetes API. Validates and processes REST requests. |
| **etcd**         | Distributed key-value store for all cluster configuration and state. Distributed key-value store. Stores cluster state and config (like service discovery, metadata). |
| **Controller Manager** | Maintains cluster state by reconciling desired vs current state. Watches the state of the cluster and triggers changes (e.g., restart pods). Includes Node Controller, ReplicaSet Controller, etc. |
| **Scheduler**    | Assigns new pods to suitable worker nodes based on resource availability, policies and constraints. |
| **Cloud Controller Manager**  | Integrates with cloud platforms (e.g., AWS, GCP); not used in on-premise clusters. |

---

### 🧱 Data plane/Node Components (Worker Nodes)

Runs application **Pods** and provides runtime environment.

| Component       | Description |
|------------------|-------------|
| **kubelet**      | Agent running on each node. Ensures containers are running as expected. Communicates with API Server. |
| **kube-proxy**   | Maintains network rules on the node. Enables service discovery and routing. and enables communication between services. |
| **Container Runtime** | Software to run containers (e.g., containerd, CRI-O, Docker). Interfaces with kubelet. |

---

## 📦 Key Objects in Kubernetes

- **Pod**: The smallest deployable unit (may contain 1+ containers).
- **Deployment**: Manages ReplicaSets and enables rolling updates.
- **Service**: Provides a stable IP and DNS to access pods.
- **ConfigMap & Secret**: Externalized configuration and sensitive data injection.
- **Namespace**: Logical segmentation within a cluster.
- **Node**: A worker machine (VM or physical) in the cluster.

---

## 🔄 How It All Works – Lifecycle Flow

1. **User submits YAML file** (e.g., a deployment) via `kubectl` or API.
2. **API Server** receives the request → stores intent in **etcd**.
3. **Scheduler** assigns the Pod to a suitable **Node**.
4. **kubelet** on that node picks up the Pod spec and communicates with **Container Runtime** to launch it.
5. **kube-proxy** updates networking to make the Pod accessible.
6. **Controller Manager** ensures declared state = actual state.

---

## 🕸️ Kubernetes Networking Model

- Every Pod gets a unique IP.
- **Flat network**: All pods can communicate without NAT.
- **Services** use virtual IPs to load balance across Pod replicas.
- External access via **NodePort**, **LoadBalancer**, or **Ingress**.

---

## 🔐 Kubernetes Security Highlights

- **RBAC** (Role-Based Access Control) for access control
- **TLS** between all components
- **Service Accounts** for workload authentication
- **Network Policies** for traffic filtering

---

## 📊 Add-on Components (Optional but Common)

- **Dashboard**: Web UI to interact with cluster
- **Helm**: Package manager for K8s apps
- **Metrics Server**: For autoscaling based on resource usage
- **Ingress Controller**: For HTTP routing (Nginx, Traefik)
- **Service Mesh**: Istio, Linkerd for traffic control, security, telemetry

---

## 🧠 Pro Tips for Interviews & Understanding

- **API Server** is the only component that interacts directly with etcd.
- **etcd** is critical – backup it regularly.
- **Control Plane** is **stateless**, apart from etcd.
- **Pods** are ephemeral – use Deployments for stability.
- **kubectl** is just a client for the API server.

---

## 🧭 Diagram (ASCII - Optional)

+---------------------+ +--------------------+
| kubectl/API |<------->| API Server |
+---------------------+ +--------------------+
|
v
+--------------------+
| etcd |
+--------------------+
|
+-------------+ +--------------------+ +------------------------+
| Scheduler |<---->| Controller Manager |<---->| Deployment, etc. (CRDs)|
+-------------+ +--------------------+ +------------------------+
|
v
+---------------------------+
| Worker Node |
|---------------------------|
| kubelet | kube-proxy |
|---------------------------|
| container runtime (e.g., containerd) |
|---------------------------|
| Pods (Containers) |
+---------------------------+

---

## ✅ Summary

- Kubernetes separates **desired state** from **actual state**, and automates the reconciliation process.
- It offers **scalability**, **resilience**, and **abstractions** to simplify application deployment.
- The **control plane** makes decisions; **worker nodes** run your applications.
- It’s **declarative**, **modular**, and **cloud-native by design**.

---
